{
    "id": "plan_final_molecules_fix_0052",
    "version": 1,
    "g_event_created": 179,
    "title": "Final Fix for Molecule Components and Associated Brittle Tests",
    "description": "This plan definitively resolves the failures in SearchBar and MarkerPopup by first fixing the brittle and flawed diagnostic tests, and then fixing the component implementations to match the reliable tests. This two-step process ensures a verifiable and correct final state.",
    "references": {
        "issue_id": "issue_0052",
        "diagnostic_test_file": "tests/diagnostics/molecule_regression_diag_test.tsx"
    },
    "tasks": [
        {
            "id": "refactor_diagnostic_tests",
            "type": "REFACTORING",
            "description": "Modify `tests/diagnostics/molecule_regression_diag_test.tsx` to make the tests more robust and reflect real-world user interaction. Specifically: 1. In the SearchBar focus test, type text into the input field before tabbing to ensure the search button is not disabled. 2. In the MarkerPopup keyboard navigation test, adjust the assertions to match the logical DOM order (Close button will likely be first or second, not last).",
            "acceptance_criteria": [
                "The SearchBar keyboard test must type into the input field.",
                "The MarkerPopup keyboard test must check for a realistic focus order based on the DOM.",
                "After refactoring, running the test file should still fail, but potentially with different, more accurate errors."
            ],
            "dependencies": [],
            "status": "PENDING",
            "confidence_level": "High",
            "justification": "The test flaws are clearly identified and the fixes are specific."
        },
        {
            "id": "final_implementation_fix",
            "type": "IMPLEMENTATION",
            "description": "Modify `SearchBar.tsx` and `MarkerPopup.tsx` to make the refactored diagnostic tests pass. 1. In `SearchBar.tsx`, ensure the tab order is `input -> search -> location` by correcting the JSX order if needed. 2. In `MarkerPopup.tsx`, ensure the button's visible text is exactly `Report issue` to satisfy the test query.",
            "acceptance_criteria": [
                "All tests in `tests/diagnostics/molecule_regression_diag_test.tsx` must pass.",
                "The `SearchBar` JSX must be in the correct physical order.",
                "The `MarkerPopup` button must have the correct visible text."
            ],
            "dependencies": [
                "refactor_diagnostic_tests"
            ],
            "status": "PENDING",
            "confidence_level": "High",
            "justification": "With reliable tests in place, the component fixes are straightforward."
        }
    ]
} 